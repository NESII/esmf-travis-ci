FROM bekozi/esmf-netcdf

ARG ESMF_BRANCH=""
RUN echo "ESMF_BRANCH=$ESMF_BRANCH"

# Build ESMF ==================================================================

ENV PATH=$PATH:$BB_MPICH_PREFIX/bin

WORKDIR ${HOME}/sandbox/esmf/src-git
RUN git clone --branch $ESMF_BRANCH --depth 1 https://github.com/esmf-org/esmf.git
WORKDIR esmf

ENV ESMF_DIR=${HOME}/sandbox/esmf/src-git/esmf
ENV ESMF_COMM=mpich3
ENV ESMF_BOPT="g"
ENV ESMF_NETCDF="split"
ENV ESMF_NETCDF_INCLUDE=${BB_NETCDFC_PREFIX}/include
ENV ESMF_NETCDF_LIBPATH=${BB_NETCDFC_PREFIX}/lib
ENV ESMF_INSTALL_PREFIX=${HOME}/sandbox/esmf/install
ENV ESMF_INSTALL_BINDIR=${ESMF_INSTALL_PREFIX}/bin
ENV ESMF_INSTALL_DOCDIR=${ESMF_INSTALL_PREFIX}/doc
ENV ESMF_INSTALL_HEADERDIR=${ESMF_INSTALL_PREFIX}/include
ENV ESMF_INSTALL_LIBDIR=${ESMF_INSTALL_PREFIX}/lib
ENV ESMF_INSTALL_MODDIR=${ESMF_INSTALL_PREFIX}/mod

ENV ESMFMKFILE=${ESMF_INSTALL_LIBDIR}/esmf.mk
ENV ESMPY_DIR=${ESMF_DIR}/src/addon/ESMPy

WORKDIR ${ESMF_DIR}
